<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexio</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lexio">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>‚ú® Lexio</h1>
                    <p class="subtitle">Your AI-powered learning companion</p>
                </div>
                <div id="auth-container">
                    <button id="google-signin-btn" class="btn btn-google hidden">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                            <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                            <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                            <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                            <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                        </svg>
                        Sign in with Google
                    </button>
                    <div id="user-info" class="user-info hidden">
                        <img id="user-photo" class="user-photo" alt="User">
                        <span id="user-name" class="user-name"></span>
                        <button id="signout-btn" class="btn btn-small">Sign Out</button>
                    </div>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="vocabulary">Lookup</button>
            <button class="tab-btn" data-tab="review">My Words</button>
            <button class="tab-btn" data-tab="homework">üì∏ Homework Helper</button>
            <button class="tab-btn" data-tab="games">üéÆ Practice Games</button>
        </nav>

        <main>
            <!-- Vocabulary Tab -->
            <section id="vocabulary-tab" class="tab-content active">
                <div class="input-section">
                    <h2>Enter a Word</h2>
                    <p class="instructions">Type any word to get its definition</p>
                    
                    <div class="vocab-input-group">
                        <input type="text" id="vocab-input" placeholder="Enter a word (e.g., serendipity)">
                        <button id="add-vocab-btn" class="btn btn-primary">Go</button>
                    </div>
                </div>

                <div id="definitions-output" class="story-output hidden">
                    <div class="output-header">
                        <h2>üìñ Vocabulary Definitions</h2>
                    </div>
                    <div id="definitions-content" class="definitions-content"></div>
                    
                    <!-- Vocabulary Quiz Section -->
                    <div id="vocabulary-quiz" class="vocabulary-quiz hidden">
                        <div class="quiz-header">
                            <h2>üéÆ Test Your Knowledge!</h2>
                            <p>Click an answer to get <strong>immediate feedback</strong> and learn the correct meaning and usage</p>
                            <div id="quiz-round-info" class="quiz-round-info hidden">
                                <span>üìö Practice Round: Focusing on words you missed</span>
                            </div>
                            <div class="quiz-score">
                                <span>Score: <span id="quiz-score">0</span> / <span id="quiz-total">0</span></span>
                            </div>
                        </div>
                        
                        <div id="quiz-container"></div>
                        
                        <div class="quiz-actions">
                            <button id="check-answers-btn" class="btn btn-primary">Check Answers</button>
                            <button id="retry-quiz-btn" class="btn btn-secondary hidden">Try Again</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Writing Tab (placeholder) -->
                        <!-- My Words Tab -->
            <section id="review-tab" class="tab-content">
                <div id="auth-prompt" class="auth-prompt">
                    <div class="auth-prompt-content">
                        <h2>ÔøΩ Sign in to Save Your Words</h2>
                        <p>Sign in with Google to automatically save all your vocabulary lookups and access them from any device!</p>
                        <button class="btn btn-google" onclick="document.getElementById('google-signin-btn').click()">
                            <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                            </svg>
                            Sign in with Google
                        </button>
                    </div>
                </div>

                <div id="my-words-content" class="my-words-content hidden">
                    <div class="my-words-header">
                        <h2>üìö My Words</h2>
                        <div class="my-words-controls">
                            <input type="text" id="search-my-words" placeholder="Search your words..." class="search-input">
                            <select id="sort-my-words" class="sort-select">
                                <option value="recent">Most Recent</option>
                                <option value="alpha">A-Z</option>
                                <option value="favorite">Favorites First</option>
                            </select>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-mini">
                            <span class="stat-mini-number" id="total-saved-words">0</span>
                            <span class="stat-mini-label">Words Saved</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-mini-number" id="total-favorites">0</span>
                            <span class="stat-mini-label">Favorites</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-mini-number" id="words-this-week">0</span>
                            <span class="stat-mini-label">This Week</span>
                        </div>
                    </div>

                    <div id="my-words-grid" class="my-words-grid"></div>
                    <div id="my-words-empty" class="empty-state hidden">
                        <p>No words saved yet. Look up your first word to get started!</p>
                    </div>
                </div>
            </section>

            <!-- Homework Helper Tab -->
            <section id="homework-tab" class="tab-content">
                <div class="homework-section">
                    <h2>üì∏ Homework Helper</h2>
                    <p class="instructions">Paste a question from an online test or upload a photo of your homework to understand all the vocabulary words!</p>
                    
                    <!-- Input Method Tabs -->
                    <div class="input-method-tabs">
                        <button class="method-tab active" data-method="text">üìù Paste Text</button>
                        <button class="method-tab" data-method="photo">üì∑ Upload Photo</button>
                    </div>
                    
                    <div class="homework-container">
                        <!-- Text Input Method -->
                        <div id="text-input-method" class="input-method active">
                            <div class="homework-input-area">
                                <h3>üìù Paste Your Question</h3>
                                <textarea id="homework-text" placeholder="Paste your test question or homework problem here...

Example:
The protagonist felt melancholy after the calamity that befell his village.

We'll identify all the vocabulary words and explain them!" rows="6"></textarea>
                                <div class="homework-tools">
                                    <button id="clear-homework-btn" class="btn btn-secondary">Clear</button>
                                    <button id="analyze-text-btn" class="btn btn-primary">üîç Find Vocabulary Words</button>
                                </div>
                            </div>
                        </div>

                        <!-- Camera Input Method -->
                        <!-- Photo Upload Method -->
                        <div id="photo-input-method" class="input-method">
                            <div class="photo-upload-area">
                                <h3>üì∑ Upload Photo or Screenshot</h3>
                                <p class="upload-instructions">Upload a photo, screenshot, or any image of your homework</p>
                                
                                <div class="upload-zone" id="homework-upload-zone">
                                    <input type="file" id="homework-photo" accept="image/*,.png,.jpg,.jpeg,.gif,.bmp,.webp" hidden>
                                    <div class="upload-placeholder">
                                        <div class="upload-icon">üì∏</div>
                                        <p>Click to upload or drag & drop</p>
                                        <p class="upload-hint">Supports: Photos, Screenshots, PNG, JPG, GIF, WebP</p>
                                    </div>
                                </div>

                                <div id="photo-preview-container" class="image-preview-container hidden">
                                    <img id="photo-preview" alt="Homework Preview">
                                    <div class="photo-tools">
                                        <button id="remove-photo-btn" class="btn btn-secondary">Remove Photo</button>
                                        <button id="analyze-photo-btn" class="btn btn-primary">üîç Find Vocabulary Words</button>
                                    </div>
                                </div>
                            </div>
                        </div>                        <!-- Image Upload Method -->
                        <div id="image-input-method" class="input-method">
                            <div class="image-upload-area">
                                <h3>Upload Student Work</h3>
                                <p class="upload-instructions">Upload a photo of handwritten work, printed assignments, or worksheets</p>
                                
                                <div class="upload-zone" id="upload-zone">
                                    <input type="file" id="image-input" accept="image/*" hidden>
                                    <div class="upload-placeholder">
                                        <div class="upload-icon">ÔøΩ</div>
                                        <p>Click to upload or drag & drop</p>
                                        <p class="upload-hint">Supports: JPG, PNG, HEIC (Max 20MB)</p>
                                    </div>
                                </div>

                                <div id="image-preview-container" class="image-preview-container hidden">
                                    <img id="image-preview" alt="Preview">
                                    <button id="remove-image-btn" class="btn btn-secondary">Remove Image</button>
                                    <button id="analyze-image-btn" class="btn btn-primary">üîç Analyze Image</button>
                                </div>
                            </div>
                        </div>

                        <!-- Results Area -->
                        <div id="homework-results" class="homework-results hidden">
                            <div class="results-header">
                                <h3>ÔøΩ Vocabulary Words Found</h3>
                                <button id="save-all-words-btn" class="btn btn-secondary">üíæ Save All to My Words</button>
                            </div>
                            
                            <div id="homework-words-grid" class="homework-words-grid"></div>
                            
                            <div id="homework-empty" class="empty-state hidden">
                                <p>No challenging vocabulary words found in this text. Try another question!</p>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Practice Games Tab -->
            <section id="games-tab" class="tab-content">
                <div class="games-container">
                    <h2>üéÆ Practice Games</h2>
                    <p class="instructions">Master your vocabulary through fun games!</p>
                    
                    <div id="games-empty" class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <p>Save some words first to start playing!</p>
                        <p class="hint">Go to "My Words" or use "Homework Helper" to add vocabulary.</p>
                    </div>

                    <div id="games-selection" class="games-grid hidden">
                        <div class="game-card" data-game="matching">
                            <div class="game-icon">üéØ</div>
                            <h3>Match It!</h3>
                            <p>Match words with their definitions</p>
                            <button class="btn game-start-btn">Play</button>
                        </div>

                        <div class="game-card" data-game="flashcards">
                            <div class="game-icon">üé¥</div>
                            <h3>Flashcards</h3>
                            <p>Quiz yourself with flashcards</p>
                            <button class="btn game-start-btn">Play</button>
                        </div>

                        <div class="game-card" data-game="fillblank">
                            <div class="game-icon">‚úèÔ∏è</div>
                            <h3>Fill the Blank</h3>
                            <p>Complete sentences with the right word</p>
                            <button class="btn game-start-btn">Play</button>
                        </div>

                        <div class="game-card" data-game="spelling">
                            <div class="game-icon">üî§</div>
                            <h3>Spelling Bee</h3>
                            <p>Type the word you hear</p>
                            <button class="btn game-start-btn">Play</button>
                        </div>
                    </div>

                    <!-- Matching Game -->
                    <div id="matching-game" class="game-area hidden">
                        <div class="game-header">
                            <h3>üéØ Match It!</h3>
                            <div class="game-stats">
                                <span>Score: <strong id="matching-score">0</strong></span>
                                <span>Time: <strong id="matching-time">0:00</strong></span>
                            </div>
                            <button class="btn-secondary" id="matching-quit">Quit</button>
                        </div>
                        <div class="matching-board" id="matching-board"></div>
                        <div id="matching-complete" class="game-complete hidden">
                            <h3>üéâ Awesome Job!</h3>
                            <p class="final-score"></p>
                            <button class="btn" id="matching-replay">Play Again</button>
                            <button class="btn-secondary" id="matching-menu">Main Menu</button>
                        </div>
                    </div>

                    <!-- Flashcards Game -->
                    <div id="flashcards-game" class="game-area hidden">
                        <div class="game-header">
                            <h3>üé¥ Flashcards</h3>
                            <div class="game-stats">
                                <span>Card: <strong><span id="flashcard-current">1</span>/<span id="flashcard-total">10</span></strong></span>
                                <span>Correct: <strong id="flashcard-correct">0</strong></span>
                            </div>
                            <button class="btn-secondary" id="flashcard-quit">Quit</button>
                        </div>
                        <div class="flashcard-container">
                            <div class="flashcard" id="flashcard">
                                <div class="flashcard-front">
                                    <div class="flashcard-word"></div>
                                </div>
                                <div class="flashcard-back">
                                    <div class="flashcard-definition"></div>
                                </div>
                            </div>
                            <div class="flashcard-controls">
                                <button class="btn" id="flashcard-flip">Flip Card</button>
                            </div>
                            <div class="flashcard-answers hidden" id="flashcard-answers">
                                <button class="btn btn-success" id="flashcard-know">I Know It! ‚úì</button>
                                <button class="btn btn-warning" id="flashcard-learning">Still Learning</button>
                            </div>
                        </div>
                        <div id="flashcard-complete" class="game-complete hidden">
                            <h3>üéâ Great Practice!</h3>
                            <p class="final-score"></p>
                            <button class="btn" id="flashcard-replay">Practice Again</button>
                            <button class="btn-secondary" id="flashcard-menu">Main Menu</button>
                        </div>
                    </div>

                    <!-- Fill the Blank Game -->
                    <div id="fillblank-game" class="game-area hidden">
                        <div class="game-header">
                            <h3>‚úèÔ∏è Fill the Blank</h3>
                            <div class="game-stats">
                                <span>Question: <strong><span id="fillblank-current">1</span>/<span id="fillblank-total">10</span></strong></span>
                                <span>Score: <strong id="fillblank-score">0</strong></span>
                            </div>
                            <button class="btn-secondary" id="fillblank-quit">Quit</button>
                        </div>
                        <div class="fillblank-question">
                            <p class="sentence" id="fillblank-sentence"></p>
                            <div class="word-choices" id="fillblank-choices"></div>
                            <div id="fillblank-feedback" class="feedback hidden"></div>
                        </div>
                        <div id="fillblank-complete" class="game-complete hidden">
                            <h3>üéâ Well Done!</h3>
                            <p class="final-score"></p>
                            <button class="btn" id="fillblank-replay">Play Again</button>
                            <button class="btn-secondary" id="fillblank-menu">Main Menu</button>
                        </div>
                    </div>

                    <!-- Spelling Bee Game -->
                    <div id="spelling-game" class="game-area hidden">
                        <div class="game-header">
                            <h3>üî§ Spelling Bee</h3>
                            <div class="game-stats">
                                <span>Word: <strong><span id="spelling-current">1</span>/<span id="spelling-total">10</span></strong></span>
                                <span>Score: <strong id="spelling-score">0</strong></span>
                            </div>
                            <button class="btn-secondary" id="spelling-quit">Quit</button>
                        </div>
                        <div class="spelling-question">
                            <div class="audio-prompt">
                                <button class="btn btn-large" id="spelling-play">
                                    üîä Play Word
                                </button>
                                <p class="hint">Listen carefully and type the word!</p>
                            </div>
                            <div class="spelling-definition" id="spelling-definition"></div>
                            <input type="text" id="spelling-input" class="spelling-input" placeholder="Type the word here..." autocomplete="off">
                            <button class="btn" id="spelling-submit">Submit</button>
                            <div id="spelling-feedback" class="feedback hidden"></div>
                        </div>
                        <div id="spelling-complete" class="game-complete hidden">
                            <h3>üéâ Fantastic!</h3>
                            <p class="final-score"></p>
                            <button class="btn" id="spelling-replay">Play Again</button>
                            <button class="btn-secondary" id="spelling-menu">Main Menu</button>
                        </div>
                    </div>
                </div>
            </section>
```
        </main>

        <!-- Word Detail Modal -->
        <div id="word-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="modal-word"></h2>
                <div class="word-details">
                    <div class="detail-section">
                        <h4>üîä Pronunciation</h4>
                        <div class="pronunciation-container">
                            <p id="modal-pronunciation" class="pronunciation-text">Loading...</p>
                            <button id="pronunciation-btn" class="btn btn-icon" title="Listen to pronunciation">
                                üîä Play
                            </button>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h4>üìù Part of Speech</h4>
                        <p id="modal-part-of-speech">Loading...</p>
                    </div>
                    <div class="detail-section">
                        <h4> Definition</h4>
                        <p id="modal-definition">Loading...</p>
                    </div>
                    <div class="detail-section chinese-section">
                        <h4>üá®üá≥ ‰∏≠ÊñáÈáä‰πâ (Chinese Translation)</h4>
                        <p id="modal-chinese" class="chinese-text">Loading...</p>
                    </div>
                    <div class="detail-section">
                        <h4>üí° Example Usage</h4>
                        <p id="modal-example">Loading...</p>
                    </div>
                    <div class="detail-section">
                        <h4>üîÑ Synonyms</h4>
                        <p id="modal-synonyms">Loading...</p>
                    </div>
                    <div class="detail-section">
                        <h4>‚ÜîÔ∏è Antonyms</h4>
                        <p id="modal-antonyms">Loading...</p>
                    </div>
                    <div class="detail-section stems-section">
                        <h4>üå± Word Stems & Patterns</h4>
                        <p id="modal-stems" class="stems-content">Loading...</p>
                    </div>
                    <div class="detail-section">
                        <h4>üìä Your Stats</h4>
                        <p>Used in <span id="modal-usage-count">0</span> stories</p>
                        <p>First practiced: <span id="modal-first-used">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, query, orderBy, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Your Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyAXUUBQdyai3Z2Yohu_ubi6mf-Usr4pTII",
          authDomain: "lexio-4df5c.firebaseapp.com",
          projectId: "lexio-4df5c",
          storageBucket: "lexio-4df5c.firebasestorage.app",
          messagingSenderId: "363181781749",
          appId: "1:363181781749:web:92d4ae8f572dee4d988bbc"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseModules = {
            signInWithPopup,
            GoogleAuthProvider,
            onAuthStateChanged,
            signOut,
            collection,
            doc,
            setDoc,
            getDoc,
            getDocs,
            deleteDoc,
            query,
            orderBy,
            where
        };
    </script>
    
    <script src="script.js?v=3.0"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }
    </script>
</body>
</html>
